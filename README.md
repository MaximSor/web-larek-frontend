# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура проекта

Код приложения разделен на слои согласно парадигме MVP:

- слой представления (View) - отвечает за отображение данных на странице.
- слой данных (Model) - отвечает за хранение и изменение данных.
- презентер (Presenter) - отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов.

Поля:

- `baseUrl: string` - базовый URL для запросов.
- `options: RequestInit` - объект опций для запросов.

Конструктор:

В конструктор передается адрес сервера и опциональный объект с заголовками запросов. Принимает базовый URL и глобальные опции для всех запросов(опционально).

Методы:

- `handleResponse` - защищенный метод принимает и обрабатывает ответ сервера.
- `get` - Выполняет GET запрос на указанный URL (эндпоинт) и возвращает промис с объектом, полученным в ответе от сервера.
- `post` - Принимает объект с данными для передачи в теле запроса в формате JSON и отправляет их на указанный эндпоинт.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Этот класс используется в презентерах для обработки событий, а также в различных слоях приложения для генерации событий.

Поля:

- `events` - свойство, содержащее карту событий и их подписчиков.

Конструктор:

В конструкторе инициализируется свойство \_events. При вызове свойств туда будут записываться новые события и подписчики на них.

Основные методы, реализуемые классом описаны интерфейсом IEvents:

- `on` - подписка на событие.
- `off` - позволяет снять обработчик с события.
- `emit` - инициализация события.
- `onAll` - подписка на все события.
- `offAll` - позволяет снять обработчики со всех событий.
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

#### Класс Component

Абстрактный базовый класс для всех компонентов пользовательского интерфейса.

Поля:

- `container` - контейнер, в который помещается компонент интерфейса.

Конструктор:

В конструкторе принимается в качестве аргумента DOM-элемент контейнера, который он сохраняет в защищенном свойстве.

Методы:

- `toggleClass` - переключить класс.
- `setText` - установить текстовое содержимое.
- `setDisabled` - сменить статус блокировки.
- `setHidden` - метод, позволяющий визуально скрыть элемент.
- `setVisible` - метод, позволяющий визуально отобразить элемент.
- `setImage` - установить изображение с алтернативным текстом.
- `render` - метод, возвращающий корневой DOM-элемент.

#### Класс Model

Абстрактный базовый класс для моделей данных.

Поля:

- `events: IEvents` - защищенное свойство, хранящее события.

Конструктор:

- Переданные в конструктор данные копируются в инстансы класса. Таким образом, для дочерних классов нет необходимости переопределять конструктор.

Методы:

- `emitChanges` - Сообщить всем что модель поменялась.

### Слой данных

#### Класс AppState

Класс AppState является основной моделью для работы с состоянием приложения, и он содержит в себе различные свойства и методы для управления каталогом продуктов, корзиной, заказами.

Поля:

- `catalog` - массив объектов товаров.
- `order` - текущий заказ.
- `basket` - корзина с добавленными товарами.
- `preview` - содержит id товара, открытого для предварительного просмотра.
- `formErrors` - содержит ошибки формы.

Методы:

- `selectProduct` - метод, меняющий выбранный товар, в случае открытия его описания.
- `addProduct` - отвечает за добавление товара в корзину.
- `removeProduct` - отвечает за удаление товара из корзины.
- `refreshBasket` - отвечает за обновление корзины и счетчика при добавлении и удалении товаров.
- `setOrderField` - отвечает за передачу данных из формы заказа.
- `setContactField` - отвечает за передачу данных из формы контактов.
- `clearBasket` - отвечает за очистку корзины.
- `clearOrder` - очищает данные заказа.
- `validateContact` - отвечает за валидацию данных в форме контактов.
- `validateOrder` - отвечает за валидацию данных в заказе.
- `setCatalog` - устанавливает каталог продуктов.

#### Класс LarekApi

Представляет API для взаимодействия с сервером (наследуемый от Api).

Поля :

- `cdn` - URL адрес CDN сервера.

Конструктор:

- создает новый экземпляр класса, принимая URL CDN сервера, базовый URL и опции запроса.

Методы:

- `getProductList` - получает список продуктов с сервера.
- `getProduct` - получает конкретный продукт с сервера.
- `orderProducts` - отправляет заказ на сервер и возвращает ответ.

### Слой представления

#### Класс Page

Класс главного экрана приложения (наследуемый от Component).

Поля:

- `_counter` - DOM-элемент, в котором будет отображаться количество товаров в корзине.
- `_gallery` - DOM-элемент для отображения каталога товаров.
- `_pageWrapper` - DOM-элемент, являющийся оболочкой страницы; необходим, чтобы заблокировать прокрутку страницы.
- `_basket` - DOM-элемент для отображения корзины.

Конструктор:

- В конструкторе инициализируются защищенные поля класса с проверкой на наличие элементов в DOM-дереве.

Методы:

- `handleBasketClick` - добавляется слушатель на клик по корзине.
  Сеттеры:
- `set counter` - устанавливает количество товаров в корзине.
- `set catalog` - устанавливает товары в каталог.
- `set locked` - позволяет заблокировать страницу для прокрутки.

#### Класс Card

Этот класс реализует карточку товара (наследуемый от Component).

Класс хранит такие данные, как:

- категория товара
- изображение товара
- цена товара;

Поля:

- `_title` - DOM-элемент для отображения названия товара.
- `_price` - DOM-элемент для отображения цены.
- `_image` - DOM-элемент для отображения картинки.
- `_description` - DOM-элемент для отображения описания товара.
- `_button` - DOM-элемент для отображения кнопки "В коризну"
- `_category` - DOM-элемент для отображения категории товара.
- `_index` - DOM-элемент для отображения индекса карточки, находящейся в корзине.

Конструктор:

- В качестве аргументов принимает контейнер для поиска и опционально объект действий. В конструкторе инициализируются защищенные поля класса с проверкой на наличие элементов в DOM-дереве. Также добавляются слушатели на клики.

Методы:

- `set id` и `get id` - позволяют установить и получить id товара.
- `set title` и `get title` - позволяют установить и получить название товара.
- `set image` - позволяет установить изображение товара.
- `set price` - позволяет установить цену товара.
- `set category` - позволяет установить категорию товара.
- `set description` - устанавливает описание товара.
- `set basketIndex` - устанавливает номер по порядку для товаров в корзине.

#### Класс Modal

Этот класс реализует модальное окно (наследуемый от Component).

Поля:

- `_closeButton` - DOM-элемент кнопки закрытия модального окна.
- `_content` - DOM-элемент для отображения контента.

Конструктор:

- В качестве аргументов принимает контейнер для поиска и обект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также доабвляются слушатели на клики.

Методы:

- `set content` - сеттер для установки контента.
- `open` - метод для открытия.
- `close` - метод для закрытия.
- `render` - метод для отрисовки.

#### Класс Basket

Этот класс реализует корзину товаров (наследуемый от Component).

Поля:

- `_list` - DOM-элемент для отображения списка товаров.
- `_total` - DOM-элемент для отображения итоговой суммы.
- `_button` - DOM-элемент для отображения кнопки.

Конструктор:

- В качестве аргументов принимает название блока, контейнер для поиска и обект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также добавляется слушатель на клик по кнопке офорления заказа.

Методы:

- `set total` - сеттер для установки стоимости товаров в корзине
- `set items` - для установки отображаемых в корзине товаров.

#### Класс Form

Этот класс управляет состоянием формы, обработкой полей ввода, ошибок и отправки на сервер (наследуемый от Component).

Поля:

- `_submit` - DOM-элемент кнопки отправки данных формы.
- `_errors` - DOM-элемент, в котором будут отображаться ошибки валидации.

Конструктор

- В качестве аргументов принимает контейнер для поиска и объект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также добавляется слушатели на сабмит и инпут формы.

Методы:

- `onInputChange` - защищенный метод для события введения данных пользователем.
- `set valid` - деактивирует кнопку сабмита, если данные в форме валидны.
- `set errors` - добавляет ошибки валидации.
- `render` - отрисовка формы.

#### Класс Order

Этот класс реализует форму заказа с выбором способа оплаты и адреса доставки (наследуемый от Form).

Поля:

- `_card` - кнопка для выбора способа оплаты: онлайн.
- `_cash` - кнопка для выбора способа оплаты: при получении.
- `_address` - поле ввода адреса.

Конструктор:

- В качестве аргументов принимает контейнер для поиска и объект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также добавляются слушатели на кнопки выбора способа оплаты и инпут адреса.

Методы:

- `set address` - сеттер для адреса.
- `toggleButtons` - переключает способ оплаты.

#### Класс Contacts

Этот класс реализует форму для оплаты заказа (наследуемый от Form).

Поля:

- `_email` - DOM-элемент инпута почты.
- `_phone` - DOM-элемент инпута телефона.

Конструктор:

- В качестве аргументов принимает контейнер для поиска и объект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также добавляются слушатели инпуты.

Методы:

- `set email` - сеттер для почты.
- `set phone` - сеттер для телефона.

#### Класс Success

Этот класс нужен для отображения данных успешного заказа (наследуемый от Component).

Поля:

- `_close` - кнопка для закрытия сообщения об успехе.
- `_description` - элемент для отображения описания успешного заказа.

Конструктор:

- В качестве аргументов принимает контейнер для поиска и объект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также добавляется слушатель на кнопку.

Методы:

Наследует методы от Component.

### Презентер События, возникающие при взаимодействии пользователя с интерфейсом.

- `items:changed` - обновление списка продуктов
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `product:add` - добавление товара в корзину
- `product:delete` - удаление товара из корзины
- `product:toggle` - переключение добавить удалить товар
- `basket:open` - открытие корзины
- `basket:changed` - обновление интерфейса корзины
- `counter:changed` - обновление счетика корзины
- `order:open` - открытие формы заказа
- `order:changed` - изменения в заказе
- `order:ready `- валидность формы оплаты
- `order:submit` - подтверджение формы оплаты
- `address:change` - изменение адреса
- `contacts:change` - изменение контактов
- `contact:ready` - валидность формы контактов
- `contacts:submit` - подтверджение формы контактов
- `errors:changed` - ошибка формы
- `payment:toggle` - смена способа оплаты
- `card:select` - открытие карточки
- `preview:changed` - просмотр продукта

### Интерфейсы

#### Интерфейс для модели данных товара

```
export interface IProduct {
  id: string;
  title: string;
  description: string;
  category: string;
  price: number;
  image: string;
}
```

#### Интерфейс для модели данных заказа

```
export interface IOrder {
  items: string[];
  total: number;
  email: string;
  phone: string;
  address: string;
  payment: string;
}
```

#### Интерфейс для обработки ответа при оформлении заказа

```
export interface IOrderSuccess {
  id: string;
  total: number;
}
```

#### Тип данных для обработки ошибки

```
export type FormErrors = Partial<Record<keyof IOrder, string>>;
```
